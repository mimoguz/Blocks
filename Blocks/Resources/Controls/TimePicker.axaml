<!--
// (c) Copyright Microsoft Corporation.
// This source is subject to the Microsoft Public License (Ms-PL).
// Please see https://go.microsoft.com/fwlink/?LinkID=131993 for details.
// All other rights reserved.
-->

<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:sys="using:System"
                    xmlns:blk="clr-namespace:Blocks.Controls">

    <Design.PreviewWith>
        <Border Padding="20" Height="500">
            <StackPanel Spacing="20" VerticalAlignment="Center">
                <TimePicker />
                <TimePicker UseSeconds="True" ClockIdentifier="12HourClock" Classes="outlined" />
                <TimePicker IsEnabled="False" />
                <TimePicker>
                    <DataValidationErrors.Error>
                        <sys:Exception>
                            <x:Arguments>
                                <x:String>Error</x:String>
                            </x:Arguments>
                        </sys:Exception>
                    </DataValidationErrors.Error>
                </TimePicker>
            </StackPanel>
        </Border>
    </Design.PreviewWith>

    <x:Double x:Key="BlockTimePickerThemeMinWidth">296</x:Double>
    <x:Double x:Key="BlockTimePickerThemeMaxWidth">456</x:Double>

    <ControlTheme x:Key="{x:Type TimePicker}" TargetType="TimePicker">

        <Setter Property="Background" Value="{DynamicResource BlockDtPickerBaseButtonBackgroundBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BlockOutlinedDtPickerBaseButtonBorderBrush}" />
        <Setter Property="BorderThickness" Value="{DynamicResource BlockControlBorderThickness}" />
        <Setter Property="Foreground" Value="{DynamicResource BlockDtPickerButtonForegroundBrush}" />
        <Setter Property="CornerRadius" Value="{DynamicResource BlockButtonCornerRadius}" />
        <Setter Property="Padding" Value="{DynamicResource BlockDtPickerButtonSectionPadding}" />

        <Setter Property="Template">
            <ControlTemplate>
                <DataValidationErrors>
                    <Grid Name="LayoutRoot">
                        <Button x:Name="PART_FlyoutButton"
                                Foreground="{TemplateBinding Foreground}"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="{TemplateBinding CornerRadius}"
                                Padding="0"
                                IsEnabled="{TemplateBinding IsEnabled}"
                                MinWidth="{DynamicResource BlockTimePickerThemeMinWidth}"
                                MaxWidth="{DynamicResource BlockTimePickerThemeMinWidth}"
                                HorizontalContentAlignment="Stretch"
                                VerticalContentAlignment="Stretch">

                            <Grid Name="PART_FlyoutButtonContentGrid">
                                <!--Ignore col defs here, set in code-->
                                <Border x:Name="PART_FirstPickerHost"
                                        Grid.Column="0"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Center">
                                    <TextBlock x:Name="PART_HourTextBlock"
                                               Text="{DynamicResource StringTimePickerHourText}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Margin="{TemplateBinding Padding}" />
                                </Border>

                                <Rectangle Name="PART_FirstColumnDivider"
                                           Fill="{DynamicResource BlockFlatDtPickerButtonDividerBrush}"
                                           HorizontalAlignment="Center"
                                           Width="1" Margin="{DynamicResource BlockDtPickerButtonDividerMargin}"
                                           Grid.Column="1" />

                                <Border x:Name="PART_SecondPickerHost"
                                        Grid.Column="2"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Center">
                                    <TextBlock x:Name="PART_MinuteTextBlock"
                                               Text="{DynamicResource StringTimePickerMinuteText}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Margin="{TemplateBinding Padding}" />
                                </Border>

                                <Rectangle Name="PART_SecondColumnDivider"
                                           Fill="{DynamicResource BlockFlatDtPickerButtonDividerBrush}"
                                           HorizontalAlignment="Center"
                                           Width="1" Margin="{DynamicResource BlockDtPickerButtonDividerMargin}"
                                           Grid.Column="3" />

                                <Border x:Name="PART_ThirdPickerHost"
                                        Grid.Column="4"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch">
                                    <TextBlock x:Name="PART_SecondTextBlock"
                                               Text="{DynamicResource StringTimePickerSecondText}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Margin="{TemplateBinding Padding}" />
                                </Border>

                                <Rectangle Name="PART_ThirdColumnDivider"
                                           Fill="{DynamicResource BlockFlatDtPickerButtonDividerBrush}"
                                           HorizontalAlignment="Center"
                                           Width="1" Margin="{DynamicResource BlockDtPickerButtonDividerMargin}"
                                           Grid.Column="5" />

                                <Border x:Name="PART_FourthPickerHost"
                                        Grid.Column="6"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch">
                                    <TextBlock x:Name="PART_PeriodTextBlock"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Margin="{TemplateBinding Padding}" />
                                </Border>
                            </Grid>
                        </Button>

                        <Popup Name="PART_Popup"
                               WindowManagerAddShadowHint="False"
                               IsLightDismissEnabled="True"
                               PlacementTarget="{TemplateBinding}"
                               Placement="Bottom">
                            <TimePickerPresenter Name="PART_PickerPresenter" />
                        </Popup>

                    </Grid>
                </DataValidationErrors>
            </ControlTemplate>
        </Setter>

        <Style Selector="^.flat">
            <Setter Property="Background" Value="{DynamicResource BlockFlatDtPickerBaseButtonBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource BlockFlatDtPickerButtonForegroundBrush}" />
            <Style Selector="^ /template/ Button#PART_FlyoutButton">
                <Setter Property="blk:Block.ButtonStyle" Value="Flat" />
            </Style>
            <Style Selector="^ /template/ Rectangle">
                <Setter Property="Fill" Value="{DynamicResource BlockFlatDtPickerButtonDividerBrush}" />
            </Style>
        </Style>

        <Style Selector="^.outlined">
            <Setter Property="Background" Value="{DynamicResource BlockOutlinedDtPickerBaseButtonBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource BlockOutlinedDtPickerButtonForegroundBrush}" />
            <Style Selector="^ /template/ Button#PART_FlyoutButton">
                <Setter Property="blk:Block.ButtonStyle" Value="Outlined" />
            </Style>
            <Style Selector="^ /template/ Rectangle">
                <Setter Property="Fill" Value="{DynamicResource BlockOutlinedDtPickerButtonDividerBrush}" />
            </Style>
        </Style>

        <Style Selector="^.opaque">
            <Setter Property="Background" Value="{DynamicResource BlockOpaqueDtPickerButtonBackgroundBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource BlockOpaqueDtPickerButtonForegroundBrush}" />
            <Style Selector="^ /template/ Button#PART_FlyoutButton">
                <Setter Property="blk:Block.ButtonStyle" Value="Opaque" />
            </Style>
            <Style Selector="^ /template/ Rectangle">
                <Setter Property="Fill" Value="{DynamicResource BlockOpaqueDtPickerButtonForegroundBrush}" />
            </Style>
        </Style>

        <Style Selector="^:hasnotime /template/ Button#PART_FlyoutButton TextBlock">
            <Setter Property="Opacity" Value="{DynamicResource BlockPlaceholderOpacity}" />
        </Style>
    </ControlTheme>


    <ControlTheme x:Key="{x:Type TimePickerPresenter}" TargetType="TimePickerPresenter">
        
        <Setter Property="Width" Value="{DynamicResource BlockDtPickerFlyoutWidth}" />
        <Setter Property="MinWidth" Value="{DynamicResource BlockDtPickerFlyoutWidth}" />
        <Setter Property="MaxHeight" Value="{DynamicResource BlockDtPickerMaxFlyoutHeight}" />
        <Setter Property="Background" Value="{DynamicResource BlockDtPickerBackgroundBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BlockDtPickerBorderBrush}" />
        <Setter Property="BorderThickness" Value="{DynamicResource BlockFlyoutBorderThickness}" />
        <Setter Property="CornerRadius" Value="{DynamicResource BlockFlyoutCornerRadius}" />

        <Setter Property="Template">
            <ControlTemplate>
                <Panel MaxHeight="{TemplateBinding MaxHeight}">
                    <Border Name="Background"
                            Background="{TemplateBinding Background}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            ClipToBounds="True">
                        <Grid Name="ContentPanel" RowDefinitions="*,Auto,Auto">
                            <Grid Name="PART_PickerContainer">
                                <Grid.Styles>
                                    <Style Selector="DateTimePickerPanel > ListBoxItem">
                                        <Setter Property="Theme" Value="{StaticResource BlockDateTimePickerItem}" />
                                    </Style>
                                </Grid.Styles>
                                <Grid.Resources>
                                    <x:Double x:Key="BlockMenuItemSpacing">0</x:Double>
                                </Grid.Resources>
                                
                                <!--Ignore col defs here, set in code-->
                                
                                <Rectangle x:Name="HighlightRect" ZIndex="-1"
                                           Fill="{DynamicResource BlockDtPickerSelectedItemBackgroundBrush}"
                                           Grid.Column="0"
                                           Grid.ColumnSpan="7"
                                           VerticalAlignment="Center"
                                           Height="{DynamicResource BlockDtPickerItemHeight}" />
                                
                                <Panel Name="PART_HourHost" Grid.Column="0">
                                    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                                  VerticalScrollBarVisibility="Hidden"
                                                  OpacityMask="{DynamicResource BlockDtPickerOpacityMask}">
                                        <DateTimePickerPanel Name="PART_HourSelector"
                                                             PanelType="Hour"
                                                             ItemHeight="{DynamicResource BlockDtPickerItemHeight}"
                                                             ShouldLoop="True" />
                                    </ScrollViewer>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Top">
                                        <RepeatButton Name="PART_HourUpButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerUpIcon}" />
                                        </RepeatButton>
                                    </Border>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Bottom">
                                        <RepeatButton Name="PART_HourDownButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerDownIcon}" />
                                        </RepeatButton>
                                    </Border>
                                </Panel>
                                
                                <Panel Name="PART_MinuteHost" Grid.Column="2">
                                    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                                  VerticalScrollBarVisibility="Hidden"
                                                  OpacityMask="{DynamicResource BlockDtPickerOpacityMask}">
                                        <DateTimePickerPanel Name="PART_MinuteSelector"
                                                             PanelType="Minute"
                                                             ItemHeight="{DynamicResource BlockDtPickerItemHeight}"
                                                             ShouldLoop="True" />
                                    </ScrollViewer>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Top">
                                        <RepeatButton Name="PART_MinuteUpButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerUpIcon}" />
                                        </RepeatButton>
                                    </Border>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Bottom">
                                        <RepeatButton Name="PART_MinuteDownButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerDownIcon}" />
                                        </RepeatButton>
                                    </Border>
                                </Panel>

                                <Panel Name="PART_SecondHost" Grid.Column="4">
                                    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                                  VerticalScrollBarVisibility="Hidden"
                                                  OpacityMask="{DynamicResource BlockDtPickerOpacityMask}">
                                        <DateTimePickerPanel Name="PART_SecondSelector"
                                                             PanelType="Second"
                                                             ItemHeight="{DynamicResource BlockDtPickerItemHeight}"
                                                             ShouldLoop="True" />
                                    </ScrollViewer>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Top">
                                        <RepeatButton Name="PART_SecondUpButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerUpIcon}" />
                                        </RepeatButton>
                                    </Border>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Bottom">
                                        <RepeatButton Name="PART_SecondDownButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerDownIcon}" />
                                        </RepeatButton>
                                    </Border>
                                </Panel>

                                <Panel Name="PART_PeriodHost" Grid.Column="6">
                                    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                                                  VerticalScrollBarVisibility="Hidden"
                                                  OpacityMask="{DynamicResource BlockDtPickerOpacityMask}">
                                        <DateTimePickerPanel Name="PART_PeriodSelector"
                                                             PanelType="TimePeriod"
                                                             ItemHeight="{DynamicResource BlockDtPickerItemHeight}"
                                                             ShouldLoop="False" />
                                    </ScrollViewer>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Top">
                                        <RepeatButton Name="PART_PeriodUpButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerUpIcon}" />
                                        </RepeatButton>
                                    </Border>
                                    <Border Background="{DynamicResource BlockDtPickerBackgroundOverlayBrush}"
                                            VerticalAlignment="Bottom">
                                        <RepeatButton Name="PART_PeriodDownButton"
                                                      Theme="{StaticResource BlockDtPickerRepeatButton}"
                                                      IsVisible="True">
                                            <PathIcon Theme="{DynamicResource BlockDtPickerDownIcon}" />
                                        </RepeatButton>
                                    </Border>
                                </Panel>
                                
                                
                                <Rectangle Name="PART_FirstSpacer"
                                           Fill="{DynamicResource BlockDtPickerSeparatorBrush}"
                                           HorizontalAlignment="Center"
                                           Width="1"
                                           Grid.Column="1" />
                                <Rectangle Name="PART_SecondSpacer"
                                           Fill="{DynamicResource BlockDtPickerSeparatorBrush}"
                                           HorizontalAlignment="Center"
                                           Width="1"
                                           Grid.Column="3" />
                                <Rectangle Name="PART_ThirdSpacer"
                                           Fill="{DynamicResource BlockDtPickerSeparatorBrush}"
                                           HorizontalAlignment="Center"
                                           Width="1"
                                           Grid.Column="5" />
                            </Grid>
                            
                            <Rectangle Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="7"
                                       Height="1"
                                       Fill="{DynamicResource BlockDtPickerSeparatorBrush}"/>

                            <Grid Name="AcceptDismissGrid"
                                  Grid.Row="2"
                                  ColumnDefinitions="*,*"
                                  ColumnSpacing="2"
                                  Margin="{DynamicResource BlockFlyoutPadding}">

                                <Button Name="PART_AcceptButton"
                                        Grid.Column="0"
                                        HorizontalAlignment="Stretch"
                                        Classes="flat"
                                        VerticalAlignment="Stretch">
                                    <PathIcon Foreground="{Binding $parent[Button].Foreground}"
                                              Data="{DynamicResource BlockCheckMark}" />
                                </Button>
                                
                                <Button Name="PART_DismissButton"
                                        Grid.Column="1"
                                        Classes="flat"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch">
                                    <PathIcon Foreground="{Binding $parent[Button].Foreground}"
                                              Data="{DynamicResource BlockCrossIcon}" />
                                </Button>
                            </Grid>
                        </Grid>
                    </Border>
                    <Border CornerRadius="{TemplateBinding CornerRadius}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"/>
                </Panel>
            </ControlTemplate>
        </Setter>
    </ControlTheme>
</ResourceDictionary>